<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel | Unipro Consultants Ltd</title>

  <link rel="stylesheet" href="index.css" />
  <link rel="stylesheet" href="admin.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">

  <style>
    /* Inline styles for immediate functionality */
    .image-preview-container {
      margin: 15px 0;
      padding: 15px;
      border: 2px dashed #ddd;
      border-radius: 8px;
      background: #f9f9f9;
      min-height: 150px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .preview-image {
      position: relative;
      border: 2px solid #fff;
      border-radius: 4px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      width: 120px;
      height: 140px;
    }

    .preview-image img {
      width: 100%;
      height: 90px;
      object-fit: cover;
      display: block;
    }

    .preview-image .image-name {
      display: block;
      font-size: 11px;
      padding: 3px 6px;
      background: rgba(0,0,0,0.7);
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .preview-image .image-size {
      display: block;
      font-size: 10px;
      color: #666;
      padding: 2px 6px;
      background: #f0f0f0;
    }

    .preview-image.existing { border-color: #28a745; }
    .preview-image.existing .image-index {
      display: block;
      font-size: 11px;
      padding: 3px 6px;
      background: #28a745;
      color: white;
    }

    .remove-existing-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #dc3545;
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    .remove-existing-btn:hover { background: #c82333; }

    .existing-images-notice {
      background: #f0f9ff;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-size: 14px;
      color: #0369a1;
      border-left: 4px solid #17a2b8;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary { background: #28a745; color: white; }
    .btn-primary:hover { background: #218838; }
    .btn-secondary { background: #6c757d; color: white; }
    .btn-secondary:hover { background: #5a6268; }
    .btn-outline { background: transparent; border: 1px solid #28a745; color: #28a745; }
    .btn-outline:hover { background: #28a745; color: white; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-danger:hover { background: #c82333; }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group { margin-bottom: 20px; }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #374151;
    }

    .form-control {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
    }

    .form-control:focus {
      outline: none;
      border-color: #28a745;
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
    }

    select.form-control {
      appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
      padding-right: 2.5rem;
    }

    textarea.form-control { min-height: 90px; resize: vertical; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    table th, table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    table th {
      background-color: #f9fafb;
      font-weight: 600;
      color: #374151;
    }

    table tr:hover { background-color: #f9fafb; }

    .actions { display: flex; gap: 8px; }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-badge.available { background: #28a745; color: white; }
    .status-badge.sold { background: #dc3545; color: white; }
    .status-badge.reserved { background: #ffc107; color: #212529; }

    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    #loginSection {
      max-width: 400px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      background: white;
    }

    #loginSection h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #374151;
    }

    hr {
      margin: 30px 0;
      border: none;
      border-top: 1px solid #e5e7eb;
    }

    .text-muted {
      color: #6c757d;
      font-style: italic;
      text-align: center;
      padding: 20px;
    }

    header {
      background: #1f2937;
      color: white;
      padding: 15px 0;
    }

    header .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    header h1 {
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: .2px;
    }

    .transaction-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .transaction-btn {
      padding: 10px 20px;
      border: 1px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .transaction-btn.active {
      background: #28a745;
      color: white;
      border-color: #28a745;
    }

    .transaction-btn:hover:not(.active) {
      border-color: #28a745;
      color: #28a745;
    }

    .features-input {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .features-input input { flex: 1; }

    .features-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .feature-tag {
      background: #e9ecef;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .feature-tag .remove-feature {
      background: none;
      border: none;
      color: #dc3545;
      cursor: pointer;
      font-size: 16px;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .feature-tag .remove-feature:hover { color: #c82333; }

    /* Due diligence checklist */
    .dd-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 10px;
      margin-top: 10px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      background: #fafafa;
    }
    .dd-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      background: white;
      border: 1px solid #eee;
    }
    .dd-item input { margin-top: 3px; }
    .dd-item strong { display: block; color: #111827; }
    .dd-item span { display: block; color: #6b7280; font-size: 12px; margin-top: 2px; }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border: 1px solid #e5e7eb;
      border-radius: 999px;
      background: #fff;
      font-size: 13px;
    }

    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
      .form-actions { flex-direction: column; }
      .btn { width: 100%; }
      table { display: block; overflow-x: auto; }
      .transaction-group { flex-direction: column; }
    }
  </style>
</head>

<body>
  <header>
    <div class="container">
      <h1>Unipro Consultants Ltd — Admin Panel</h1>
      <div class="pill">
        <i class="fas fa-shield-alt"></i>
        <span>Land & Plot Listings • Due Diligence First</span>
      </div>
    </div>
  </header>

  <main class="admin-container">
    <!-- Login Form -->
    <section id="loginSection">
      <h2>Admin Login</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" class="form-control" required placeholder="Enter username" />
        </div>
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" class="form-control" required placeholder="Enter password" />
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Login</button>
      </form>
    </section>

    <!-- Listings Management -->
    <section id="adminSection" style="display:none;">
      <div id="formStatus" style="display:none;" class="existing-images-notice"></div>

      <h2 id="formTitle">Add New Listing</h2>

      <form id="propertyForm">
        <input type="hidden" id="propertyId" />

        <div class="form-row">
          <div class="form-group">
            <label for="title">Listing Title *</label>
            <input type="text" id="title" class="form-control" required placeholder="e.g., 1/8 Acre Plot – Katoloni, Machakos" />
          </div>

          <div class="form-group">
            <label for="location">Location *</label>
            <select id="location" class="form-control" required>
              <option value="">Select Location</option>
              <option value="machakos">Machakos</option>
              <option value="katoloni">Katoloni</option>
              <option value="wote">Wote</option>
              <option value="kangundo-road">Kangundo Road</option>
              <option value="makueni">Makueni</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Listing Category *</label>
            <div class="transaction-group">
              <button type="button" class="transaction-btn active" data-transaction="plot-sale">
                <i class="fas fa-map"></i> Plot for Sale
              </button>
              <button type="button" class="transaction-btn" data-transaction="land-sale">
                <i class="fas fa-tree"></i> Land for Sale
              </button>
              <button type="button" class="transaction-btn" data-transaction="investment">
                <i class="fas fa-chart-line"></i> Investment Deal
              </button>
            </div>
            <!-- Keep same hidden input id for compatibility with admin.js -->
            <input type="hidden" id="transaction" value="plot-sale" />
          </div>

          <div class="form-group">
            <label for="type">Land Type *</label>
            <select id="type" class="form-control" required>
              <option value="">Select Land Type</option>
              <optgroup label="Plots">
                <option value="plot-residential">Residential Plot</option>
                <option value="plot-commercial">Commercial Plot</option>
                <option value="plot-gated">Gated Community Plot</option>
              </optgroup>
              <optgroup label="Land">
                <option value="land-agricultural">Agricultural Land</option>
                <option value="land-industrial">Industrial Land</option>
                <option value="land-ranch">Ranch / Large Acreage</option>
              </optgroup>
              <optgroup label="Process">
                <option value="subdivision-ready">Subdivision Ready</option>
                <option value="title-deed-ready">Title Deed Ready</option>
              </optgroup>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="price">Price (KES) *</label>
            <input type="number" id="price" class="form-control" required placeholder="e.g., 350000" min="0" />
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select id="status" class="form-control" required>
              <option value="available">Available</option>
              <option value="reserved">Reserved</option>
              <option value="sold">Sold</option>
            </select>
          </div>
        </div>

        <!-- Replace house fields with land-specific fields (IDs kept to avoid breaking JS) -->
        <div class="form-row">
          <div class="form-group">
            <label for="bedrooms">Land Size (Numeric)</label>
            <input type="number" id="bedrooms" class="form-control" min="0" value="0" placeholder="Optional numeric value" />
            <small style="color:#6c757d;font-size:12px;">This field is reused by the system. Put a numeric value if needed.</small>
          </div>

          <div class="form-group">
            <label for="bathrooms">Frontage / Road Access (Numeric)</label>
            <input type="number" id="bathrooms" class="form-control" min="0" value="0" placeholder="Optional numeric value" />
            <small style="color:#6c757d;font-size:12px;">Optional numeric info. You can also describe in the description.</small>
          </div>

          <div class="form-group">
            <label for="parking">Utilities Score (Numeric)</label>
            <input type="number" id="parking" class="form-control" min="0" value="0" placeholder="Optional numeric value" />
            <small style="color:#6c757d;font-size:12px;">Optional numeric info. Use features list for details.</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="size">Plot Area / Size *</label>
            <input type="text" id="size" class="form-control" required placeholder="e.g., 1/8 acre, 50x100, 0.25 acre" />
          </div>

          <div class="form-group">
            <label for="whatsapp">WhatsApp Number *</label>
            <input type="text" id="whatsapp" class="form-control" required placeholder="254704564880" value="254704564880" />
            <small style="color:#6c757d;font-size:12px;">Format: 2547XXXXXXXX (no +, no spaces). From company contacts.</small>
          </div>
        </div>

        <!-- Due diligence checklist aligned to the Unipro document -->
        <div class="form-group">
          <label>Due Diligence Checklist (Optional but recommended)</label>
          <div class="dd-grid">
            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="certificate-of-search" checked>
              <div>
                <strong>Ownership Certificate of Search</strong>
                <span>Verify ownership details from lands registry.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="registry-index-map" checked>
              <div>
                <strong>Registry Index Map (RIM)</strong>
                <span>Confirm boundaries and map reference.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="ground-confirmation" checked>
              <div>
                <strong>Ground Confirmation</strong>
                <span>Location identification & area confirmation on ground.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="id-confirmation" checked>
              <div>
                <strong>Identity Confirmation</strong>
                <span>Confirm all parties & capacity to transact.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="agreement-to-sale" checked>
              <div>
                <strong>Agreement to Sale</strong>
                <span>Drafting and execution of sale agreement.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="subdivision" >
              <div>
                <strong>Subdivision (If Needed)</strong>
                <span>Subdivision support when parcel must be split.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="lcb-consent" >
              <div>
                <strong>Land Control Board Consent</strong>
                <span>Consent to subdivide or transfer where required.</span>
              </div>
            </label>

            <label class="dd-item">
              <input type="checkbox" class="dd-check" value="transfer" checked>
              <div>
                <strong>Transfer to Purchaser</strong>
                <span>Transfer into buyer’s name + confirm by search.</span>
              </div>
            </label>
          </div>

          <!-- store selected checklist as JSON for your admin.js (non-breaking) -->
          <input type="hidden" id="dueDiligence" value="[]">
          <small style="color:#6c757d;font-size:12px;">
            These steps reflect Unipro's documented due diligence process. :contentReference[oaicite:3]{index=3}
          </small>
        </div>

        <!-- Optional Due Diligence Package -->
        <div class="form-group">
          <label>Due Diligence Package</label>
          <div class="form-row">
            <div class="form-group">
              <label for="ddPackage">Package Type</label>
              <select id="ddPackage" class="form-control">
                <option value="none">Not Included / Not Selected</option>
                <option value="standard-50000">Standard Due Diligence (KSh 50,000)</option>
              </select>
              <small style="color:#6c757d;font-size:12px;">
                Standard package aligns with the company quotation total after discount. :contentReference[oaicite:4]{index=4}
              </small>
            </div>

            <div class="form-group">
              <label for="ddNotes">Package Notes</label>
              <input type="text" id="ddNotes" class="form-control" placeholder="e.g., Includes Search + RIM + Survey report + Agreement" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="description">Listing Description *</label>
          <textarea id="description" class="form-control" rows="4" required
            placeholder="Describe the plot: access road, neighborhood, landmarks, title status, utilities, payment plan, and what due diligence is available."></textarea>
        </div>

        <div class="form-group">
          <label>Listing Features</label>
          <div class="features-input">
            <input type="text" id="featureInput" class="form-control" placeholder="Add a feature (e.g., Ready title, Water on site, Near tarmac)" />
            <button type="button" id="addFeature" class="btn btn-outline">
              <i class="fas fa-plus"></i> Add
            </button>
          </div>
          <div id="featuresList" class="features-list"></div>
          <input type="hidden" id="features" value="[]">
        </div>

        <div class="form-group">
          <label for="images">Listing Images *</label>
          <input type="file" id="images" class="form-control" multiple accept="image/*" required />
          <small style="color:#6c757d;font-size:12px;">Upload plot photos, beacons, nearby landmarks, and map screenshots (clear & high quality).</small>

          <div class="form-group">
            <label>New Images Preview</label>
            <div id="imagePreview" class="image-preview-container">
              <p class="text-muted">No images selected</p>
            </div>
            <button type="button" id="clearPreview" class="btn btn-secondary" style="margin-top: 10px;">
              <i class="fas fa-times"></i> Clear New Images
            </button>
          </div>

          <div class="form-group">
            <label>Existing Images</label>
            <div id="existingImagesPreview" class="image-preview-container">
              <p class="text-muted">No existing images</p>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" id="submitBtn" class="btn btn-primary">
            <i class="fas fa-save"></i> Create Listing
          </button>
          <button type="button" id="resetForm" class="btn btn-outline">
            <i class="fas fa-redo"></i> Reset Form
          </button>
          <button type="button" id="logoutBtn" class="btn btn-danger">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </form>

      <hr />

      <h3>Existing Listings</h3>
      <div style="overflow-x:auto;">
        <table id="propertiesTable">
          <thead>
            <tr>
              <th>Title</th>
              <th>Location</th>
              <th>Type</th>
              <th>Category</th>
              <th>Price</th>
              <th>Status</th>
              <th>Images</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="8" style="text-align:center; padding:40px;">
                <i class="fas fa-spinner fa-spin"></i> Loading listings...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    // Keep your current JS file — we only added extra fields.
    // Non-breaking: admin.js will still run.
    // We also serialize due diligence selections into #dueDiligence for you.

    (function () {
      const ddHidden = document.getElementById("dueDiligence");
      const ddChecks = document.querySelectorAll(".dd-check");

      function syncDueDiligence() {
        const selected = Array.from(ddChecks)
          .filter(c => c.checked)
          .map(c => c.value);
        if (ddHidden) ddHidden.value = JSON.stringify(selected);
      }

      ddChecks.forEach(c => c.addEventListener("change", syncDueDiligence));
      syncDueDiligence();
    })();
  </script>

  <script src="admin.js"></script>
</body>
</html>